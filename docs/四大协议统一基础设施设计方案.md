# å››å¤§åè®®ç»Ÿä¸€åŸºç¡€è®¾æ–½è®¾è®¡æ–¹æ¡ˆ

## æ¦‚è¿°

æœ¬æ–‡æ¡£è®¾è®¡äº†ACPã€A2Aã€MCPã€BIRå››å¤§åè®®çš„ç»Ÿä¸€åŸºç¡€è®¾æ–½æ¶æ„ï¼Œé€šè¿‡æŠ½è±¡å…±æ€§åŸºç¡€ç»„ä»¶ï¼Œå®ç°åè®®å±‚çš„ç»Ÿä¸€ç®¡ç†ã€ç›‘æ§ã€è®¤è¯å’Œé…ç½®ï¼Œé™ä½ç³»ç»Ÿå¤æ‚åº¦ï¼Œæå‡å¼€å‘å’Œè¿ç»´æ•ˆç‡ã€‚

## è®¾è®¡ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡
1. **ç»Ÿä¸€ç®¡ç†** - å››å¤§åè®®å…±äº«åŸºç¡€è®¾æ–½ï¼Œç»Ÿä¸€å…¥å£å’Œå‡ºå£
2. **é™ä½å¤æ‚åº¦** - é¿å…é‡å¤å»ºè®¾ï¼Œå‡å°‘ç»´æŠ¤æˆæœ¬
3. **æå‡æ€§èƒ½** - ç»Ÿä¸€è¿æ¥æ± ã€ç¼“å­˜å’Œè´Ÿè½½å‡è¡¡
4. **å¢å¼ºå®‰å…¨** - ç»Ÿä¸€è®¤è¯æˆæƒå’Œå®‰å…¨æ§åˆ¶
5. **ç®€åŒ–è¿ç»´** - ç»Ÿä¸€ç›‘æ§ã€æ—¥å¿—å’Œé…ç½®ç®¡ç†

### æŠ€æœ¯ç›®æ ‡
- **é«˜å¯ç”¨æ€§** - åŸºç¡€è®¾æ–½å¯ç”¨æ€§ > 99.9%
- **é«˜æ€§èƒ½** - åè®®è·¯ç”±å»¶è¿Ÿ < 10ms
- **é«˜å¹¶å‘** - æ”¯æŒ10000+å¹¶å‘åè®®è°ƒç”¨
- **æ‰©å±•æ€§** - æ”¯æŒæ–°åè®®å¿«é€Ÿæ¥å…¥
- **å…¼å®¹æ€§** - ä¿æŒç°æœ‰åè®®åŠŸèƒ½å®Œæ•´æ€§

## ç°çŠ¶åˆ†æ

### ğŸ“Š åè®®å…±æ€§åˆ†æ

| åŸºç¡€è®¾æ–½ç»„ä»¶ | ACP | A2A | MCP | BIR | å¯ç»Ÿä¸€æ€§ | å®æ–½ä¼˜å…ˆçº§ |
|-------------|-----|-----|-----|-----|---------|-----------|
| **ç½‘å…³å±‚** | âœ… | âœ… | âœ… | âœ… | â­â­â­â­â­ | P0 |
| **æ³¨å†Œä¸­å¿ƒ** | âœ… | âœ… | âœ… | âœ… | â­â­â­â­â­ | P0 |
| **è®¤è¯æˆæƒ** | âœ… | âœ… | âœ… | âœ… | â­â­â­â­â­ | P0 |
| **ç›‘æ§è¿½è¸ª** | âœ… | âœ… | âœ… | âœ… | â­â­â­â­â­ | P0 |
| **è¿æ¥ç®¡ç†** | âœ… | âœ… | âœ… | âŒ | â­â­â­â­ | P1 |
| **è´Ÿè½½å‡è¡¡** | âœ… | âœ… | âœ… | âœ… | â­â­â­â­ | P1 |
| **é…ç½®ç®¡ç†** | âœ… | âœ… | âœ… | âœ… | â­â­â­â­â­ | P0 |
| **é”™è¯¯å¤„ç†** | âœ… | âœ… | âœ… | âœ… | â­â­â­â­â­ | P0 |
| **é€Ÿç‡é™åˆ¶** | âœ… | âœ… | âœ… | âœ… | â­â­â­â­ | P1 |
| **æ•°æ®è½¬æ¢** | âœ… | âœ… | âœ… | âœ… | â­â­â­ | P2 |

### ğŸ—ï¸ ç°æœ‰æ¡†æ¶ç»“æ„åˆ†æ

#### ç°æœ‰ä¼˜åŠ¿
- **é€šä¿¡åŸŸ(communication/)** - å·²æœ‰protocols/ã€adapters/ç»“æ„ï¼Œä¾¿äºåè®®é›†æˆ
- **åè°ƒåŸŸ(coordination/)** - å·²æœ‰registry/ã€governance/ï¼Œå¯æ‰©å±•ä¸ºç»Ÿä¸€æ³¨å†Œä¸­å¿ƒ
- **ç›‘æ§åŸŸ(monitoring/)** - å·²æœ‰logging/ã€metrics/ã€tracing/ï¼ŒåŸºç¡€è®¾æ–½å®Œå–„
- **æ‰§è¡ŒåŸŸ(execution/)** - å·²æœ‰ç»Ÿä¸€çš„executorï¼Œä¾¿äºåè®®æ‰§è¡Œé›†æˆ
- **çŠ¶æ€åŸŸ(state/)** - å·²æœ‰context/ã€memory/ï¼Œæ”¯æŒåè®®çŠ¶æ€ç®¡ç†

#### éœ€è¦æ–°å¢
- **ç»Ÿä¸€ç½‘å…³å±‚** - ç¼ºå°‘åè®®å…¥å£ç»Ÿä¸€ç®¡ç†
- **ç»Ÿä¸€è®¤è¯æˆæƒ** - å„åè®®æƒé™æ§åˆ¶åˆ†æ•£
- **ç»Ÿä¸€è¿æ¥æ± ** - åè®®è¿æ¥ç®¡ç†æœªç»Ÿä¸€
- **åè®®é€‚é…å±‚** - ç¼ºå°‘æ ‡å‡†åŒ–çš„åè®®é€‚é…æ¡†æ¶

## æ¶æ„è®¾è®¡

### æ•´ä½“åˆ†å±‚æ¶æ„

```mermaid
graph TB
    subgraph "å¤–éƒ¨è¯·æ±‚å±‚"
        EXT1[ACPå®¢æˆ·ç«¯]
        EXT2[A2Aæ™ºèƒ½ä½“]
        EXT3[MCPå·¥å…·]
        EXT4[BIRç”¨æˆ·è¯·æ±‚]
        EXT5[å…¶ä»–å¤–éƒ¨ç³»ç»Ÿ]
    end
    
    subgraph "ç»Ÿä¸€åŸºç¡€è®¾æ–½å±‚ (Infrastructure) - æ¨ªåˆ‡å…³æ³¨ç‚¹"
        UG[ç»Ÿä¸€ç½‘å…³<br/>Unified Gateway<br/>åè®®è¯†åˆ«å’Œè·¯ç”±]
        UA[ç»Ÿä¸€è®¤è¯æˆæƒ<br/>Unified Auth<br/>è·¨ç³»ç»Ÿæƒé™æ§åˆ¶]
        UM[ç»Ÿä¸€ç›‘æ§è¿½è¸ª<br/>Unified Monitoring<br/>å…¨é“¾è·¯è¿½è¸ª]
        UC[ç»Ÿä¸€é…ç½®ç®¡ç†<br/>Unified Config<br/>é…ç½®ç»Ÿä¸€ç®¡ç†]
        UE[ç»Ÿä¸€é”™è¯¯å¤„ç†<br/>Unified Error<br/>ç»Ÿä¸€å¼‚å¸¸å¤„ç†]
        UN[ç»Ÿä¸€è¿æ¥æ± <br/>Unified Connection<br/>è¿æ¥å¤ç”¨ç®¡ç†]
    end
    
    subgraph "åè®®é€‚é…å±‚ (Protocol Adapters)"
        PA[ACPé€‚é…å™¨]
        PB[A2Aé€‚é…å™¨]
        PC[MCPé€‚é…å™¨]
        PD[BIRé€‚é…å™¨]
        PE[å¤–éƒ¨æœåŠ¡é€‚é…å™¨]
    end
    
    subgraph "åè°ƒåŸŸ (Coordination Domain) - ä¸šåŠ¡åè°ƒå±‚"
        subgraph "æ™ºèƒ½ä½“åè°ƒ"
            UR[æœåŠ¡æ³¨å†Œå‘ç°<br/>ServiceRegistry<br/>æ™ºèƒ½ä½“æœåŠ¡ç®¡ç†]
            UL[è´Ÿè½½å‡è¡¡<br/>LoadBalancer<br/>æ™ºèƒ½ä½“è´Ÿè½½åˆ†å‘]
            CM[å®¹å™¨ç®¡ç†<br/>ContainerManager<br/>æ™ºèƒ½ä½“å®¹å™¨åŒ–]
        end
        
        subgraph "ä»»åŠ¡åè°ƒ"
            TS[ä»»åŠ¡è°ƒåº¦<br/>TaskScheduler<br/>ä»»åŠ¡åˆ†å‘è°ƒåº¦]
            RA[èµ„æºåˆ†é…<br/>ResourceAllocator<br/>è®¡ç®—èµ„æºç®¡ç†]
            HC[å¥åº·æ£€æŸ¥<br/>HealthChecker<br/>æœåŠ¡å¥åº·ç›‘æ§]
        end
    end
    
    subgraph "ç°æœ‰ä¸šåŠ¡åŸŸ (Business Domains)"
        COM[é€šä¿¡åŸŸ<br/>Communication]
        EXE[æ‰§è¡ŒåŸŸ<br/>Execution]
        STA[çŠ¶æ€åŸŸ<br/>State]
        MON[ç›‘æ§åŸŸ<br/>Monitoring]
        COR[æ ¸å¿ƒåŸŸ<br/>Core]
    end
    
    subgraph "å¤–éƒ¨æœåŠ¡å±‚ (External Services)"
        DB[æ•°æ®åº“æœåŠ¡]
        LLM[å¤§æ¨¡å‹API<br/>OneAPIç½‘å…³]
        TOOLS[å¤–éƒ¨å·¥å…·æœåŠ¡]
        STORAGE[å­˜å‚¨æœåŠ¡]
        API[ç¬¬ä¸‰æ–¹API]
    end
    
    %% è¯·æ±‚æµå‘
    EXT1 --> UG
    EXT2 --> UG
    EXT3 --> UG
    EXT4 --> UG
    EXT5 --> UG
    
    %% ç»Ÿä¸€åŸºç¡€è®¾æ–½å¤„ç†
    UG --> PA
    UG --> PB
    UG --> PC
    UG --> PD
    UG --> PE
    
    %% é€‚é…å™¨åˆ°åè°ƒåŸŸ
    PA --> UR
    PB --> UR
    PC --> UR
    PD --> UR
    PE --> UR
    
    %% åè°ƒåŸŸå†…éƒ¨åè°ƒ
    UR --> TS
    UR --> CM
    TS --> RA
    TS --> HC
    
    %% åè°ƒåŸŸåˆ°ä¸šåŠ¡åŸŸ
    TS --> COM
    TS --> EXE
    TS --> STA
    CM --> COR
    
    %% ä¸šåŠ¡åŸŸåˆ°å¤–éƒ¨æœåŠ¡
    COM --> LLM
    EXE --> TOOLS
    STA --> DB
    MON --> STORAGE
    COR --> API
    
    %% ç»Ÿä¸€åŸºç¡€è®¾æ–½çš„æ¨ªåˆ‡æ”¯æ’‘
    UA -.-> UR
    UA -.-> TS
    UA -.-> COM
    UA -.-> EXE
    
    UM -.-> UR
    UM -.-> TS
    UM -.-> COM
    UM -.-> EXE
    
    UC -.-> UR
    UC -.-> TS
    UC -.-> COM
    UC -.-> EXE
    
    UE -.-> UR
    UE -.-> TS
    UE -.-> COM
    UE -.-> EXE
    
    UN -.-> LLM
    UN -.-> DB
    UN -.-> TOOLS
    UN -.-> STORAGE
```

### åˆ†å±‚èŒè´£å®šä¹‰

#### 1. ç»Ÿä¸€åŸºç¡€è®¾æ–½å±‚ (Infrastructure Layer)
**èŒè´£èŒƒå›´ï¼šæ¨ªåˆ‡å…³æ³¨ç‚¹å’ŒåŸºç¡€èƒ½åŠ›**
- âœ… **åè®®å¤„ç†** - å››å¤§åè®®çš„è¯†åˆ«ã€è·¯ç”±ã€é€‚é…
- âœ… **è®¤è¯æˆæƒ** - è·¨ç³»ç»Ÿçš„ç»Ÿä¸€æƒé™æ§åˆ¶
- âœ… **ç›‘æ§è¿½è¸ª** - å…¨é“¾è·¯çš„åˆ†å¸ƒå¼è¿½è¸ª
- âœ… **é…ç½®ç®¡ç†** - ç»Ÿä¸€çš„é…ç½®å’Œçƒ­æ›´æ–°
- âœ… **é”™è¯¯å¤„ç†** - ç»Ÿä¸€çš„å¼‚å¸¸å¤„ç†å’Œé‡è¯•
- âœ… **è¿æ¥ç®¡ç†** - å¤–éƒ¨æœåŠ¡çš„è¿æ¥æ± å’Œå¤ç”¨

#### 2. åè°ƒåŸŸ (Coordination Domain)  
**èŒè´£èŒƒå›´ï¼šä¸šåŠ¡åè°ƒå’Œèµ„æºç®¡ç†**
- âœ… **æ™ºèƒ½ä½“ç®¡ç†** - Agentçš„æ³¨å†Œã€å‘ç°ã€ç”Ÿå‘½å‘¨æœŸ
- âœ… **ä»»åŠ¡è°ƒåº¦** - ä»»åŠ¡çš„åˆ†å‘ã€è°ƒåº¦ã€çŠ¶æ€ç®¡ç†
- âœ… **èµ„æºåˆ†é…** - è®¡ç®—èµ„æºçš„åˆ†é…å’Œç›‘æ§
- âœ… **å®¹å™¨ç®¡ç†** - Agentå®¹å™¨åŒ–éƒ¨ç½²å’Œç®¡ç†
- âœ… **è´Ÿè½½å‡è¡¡** - ä¸šåŠ¡å±‚é¢çš„è´Ÿè½½åˆ†å‘
- âœ… **å¥åº·æ£€æŸ¥** - ä¸šåŠ¡æœåŠ¡çš„å¥åº·ç›‘æ§

### é›†æˆæ¶æ„è®¾è®¡

#### ç»Ÿä¸€åŸºç¡€è®¾æ–½ä¸åè°ƒåŸŸçš„åä½œæ¨¡å¼

```python
# åè°ƒåŸŸé›†æˆç»Ÿä¸€åŸºç¡€è®¾æ–½
class EnhancedServiceRegistry:
    """å¢å¼ºçš„æœåŠ¡æ³¨å†Œä¸­å¿ƒ - é›†æˆç»Ÿä¸€åŸºç¡€è®¾æ–½"""
    
    def __init__(self, config: Dict[str, Any]):
        # ä¿ç•™åŸæœ‰åè°ƒåŸŸåŠŸèƒ½
        self.original_registry = ServiceRegistry()
        
        # é›†æˆç»Ÿä¸€åŸºç¡€è®¾æ–½
        self.unified_registry = UnifiedRegistry(config)
        self.unified_auth = UnifiedAuth(config)
        self.unified_tracer = UnifiedTracer(config)
        
    async def register_agent(
        self,
        agent_info: AgentInfo,
        user_id: Optional[str] = None
    ) -> bool:
        """æ³¨å†Œæ™ºèƒ½ä½“ - åŒé‡æ³¨å†Œ"""
        
        # 1. ç»Ÿä¸€è®¤è¯æˆæƒæ£€æŸ¥
        auth_result = await self.unified_auth.authorize(
            user_id=user_id,
            resource="agent:register",
            permission="write"
        )
        if not auth_result:
            raise PermissionError("Agentæ³¨å†Œæƒé™ä¸è¶³")
        
        # 2. ç»Ÿä¸€ç›‘æ§è¿½è¸ª
        span = self.unified_tracer.start_span(
            "agent_registration",
            "coordination",
            tags={"agent_id": agent_info.agent_id, "user_id": user_id}
        )
        
        try:
            # 3. ä¸šåŠ¡å±‚æ³¨å†Œ (ç°æœ‰é€»è¾‘)
            business_success = await self.original_registry.register_service(
                service_name=agent_info.name,
                service_type="agent",
                host=agent_info.host,
                port=agent_info.port,
                metadata={"agent_type": agent_info.agent_type}
            )
            
            # 4. åŸºç¡€è®¾æ–½å±‚æ³¨å†Œ (æ–°å¢)
            if business_success:
                unified_service = UnifiedService(
                    service_id=agent_info.agent_id,
                    service_type="agent",
                    name=agent_info.name,
                    endpoint=f"http://{agent_info.host}:{agent_info.port}",
                    capabilities=agent_info.capabilities,
                    metadata={
                        "agent_type": agent_info.agent_type,
                        "coordination_managed": True
                    }
                )
                infrastructure_success = await self.unified_registry.register_service(
                    unified_service
                )
                
                if not infrastructure_success:
                    # å›æ»šä¸šåŠ¡å±‚æ³¨å†Œ
                    await self.original_registry.deregister_service(agent_info.agent_id)
                    return False
            
            self.unified_tracer.finish_span(span, TraceStatus.SUCCESS)
            return business_success
            
        except Exception as e:
            self.unified_tracer.finish_span(span, TraceStatus.ERROR)
            raise
```

### æ¨¡å—å±‚æ¬¡ç»“æ„ (ä¿®æ­£ç‰ˆ)

```
src/
â”œâ”€â”€ infrastructure/                    # ç»Ÿä¸€åŸºç¡€è®¾æ–½å±‚ (æ–°å¢)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ README.md
â”‚   â”‚
â”‚   â”œâ”€â”€ gateway/                       # ç»Ÿä¸€ç½‘å…³
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ unified_gateway.py         # ç½‘å…³æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ protocol_router.py         # åè®®è·¯ç”±å™¨
â”‚   â”‚   â”œâ”€â”€ gateway_middleware.py      # ç½‘å…³ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ rate_limiter.py           # é€Ÿç‡é™åˆ¶å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ registry/                      # ç»Ÿä¸€æ³¨å†Œä¸­å¿ƒ (åŸºç¡€è®¾æ–½å±‚)
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ unified_registry.py        # åŸºç¡€è®¾æ–½æ³¨å†Œä¸­å¿ƒ
â”‚   â”‚   â”œâ”€â”€ service_discovery.py       # è·¨åŸŸæœåŠ¡å‘ç°
â”‚   â”‚   â”œâ”€â”€ health_checker.py         # åŸºç¡€è®¾æ–½å¥åº·æ£€æŸ¥
â”‚   â”‚   â””â”€â”€ metadata_manager.py       # å…ƒæ•°æ®ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ auth/                          # ç»Ÿä¸€è®¤è¯æˆæƒ
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ unified_auth.py           # è®¤è¯æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ permission_manager.py     # æƒé™ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ token_manager.py          # ä»¤ç‰Œç®¡ç†
â”‚   â”‚   â””â”€â”€ security_policy.py        # å®‰å…¨ç­–ç•¥
â”‚   â”‚
â”‚   â”œâ”€â”€ monitoring/                    # ç»Ÿä¸€ç›‘æ§
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ unified_tracer.py         # ç»Ÿä¸€è¿½è¸ª
â”‚   â”‚   â”œâ”€â”€ metrics_aggregator.py     # æŒ‡æ ‡èšåˆ
â”‚   â”‚   â”œâ”€â”€ alert_manager.py          # å‘Šè­¦ç®¡ç†
â”‚   â”‚   â””â”€â”€ dashboard_api.py          # ä»ªè¡¨æ¿API
â”‚   â”‚
â”‚   â”œâ”€â”€ connection/                    # ç»Ÿä¸€è¿æ¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ connection_pool.py        # è¿æ¥æ± 
â”‚   â”‚   â”œâ”€â”€ transport_manager.py      # ä¼ è¾“ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ session_manager.py        # ä¼šè¯ç®¡ç†
â”‚   â”‚   â””â”€â”€ protocol_converter.py     # åè®®è½¬æ¢
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                        # ç»Ÿä¸€é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ config_manager.py         # é…ç½®ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ protocol_config.py        # åè®®é…ç½®
â”‚   â”‚   â”œâ”€â”€ dynamic_config.py         # åŠ¨æ€é…ç½®
â”‚   â”‚   â””â”€â”€ config_validator.py       # é…ç½®éªŒè¯
â”‚   â”‚
â”‚   â””â”€â”€ error/                         # ç»Ÿä¸€é”™è¯¯å¤„ç†
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ error_handler.py          # é”™è¯¯å¤„ç†å™¨
â”‚       â”œâ”€â”€ retry_manager.py          # é‡è¯•ç®¡ç†
â”‚       â”œâ”€â”€ circuit_breaker.py        # ç†”æ–­å™¨
â”‚       â””â”€â”€ fault_tolerance.py        # å®¹é”™æœºåˆ¶
â”‚
â”œâ”€â”€ communication/
â”‚   â”œâ”€â”€ protocol_adapters/             # åè®®é€‚é…å±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base_adapter.py           # é€‚é…å™¨åŸºç±»
â”‚   â”‚   â”œâ”€â”€ acp_adapter.py            # ACPé€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ a2a_adapter.py            # A2Aé€‚é…å™¨
â”‚   â”‚   â”œâ”€â”€ mcp_adapter.py            # MCPé€‚é…å™¨
â”‚   â”‚   â””â”€â”€ bir_adapter.py            # BIRé€‚é…å™¨
â”‚   â”‚
â”‚   â””â”€â”€ llm/                          # OneAPIå¤§æ¨¡å‹ç½‘å…³é›†æˆ
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ oneapi_client.py          # OneAPIå®¢æˆ·ç«¯
â”‚   â”‚   â””â”€â”€ token_monitor.py          # Tokenç›‘æ§ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ intelligent_router.py     # æ™ºèƒ½è·¯ç”±å™¨
â”‚   â”‚   â””â”€â”€ cost_optimizer.py         # æˆæœ¬ä¼˜åŒ–å™¨
â”‚   â”‚   â””â”€â”€ context_optimizer.py      # ä¸Šä¸‹æ–‡ä¼˜åŒ–å™¨
â”‚   â”‚   â””â”€â”€ fallback_manager.py       # é™çº§ç®¡ç†å™¨
â”‚   â”‚
â”‚   â””â”€â”€ coordination/                      # åè°ƒåŸŸ (ç°æœ‰ï¼Œæ‰©å±•é›†æˆ)
â”‚       â”œâ”€â”€ container/                     # å®¹å™¨ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ agent_container.py         # æ™ºèƒ½ä½“å®¹å™¨
â”‚       â”‚   â”œâ”€â”€ container_manager.py       # å®¹å™¨ç®¡ç†å™¨
â”‚       â”‚   â””â”€â”€ resource_manager.py        # èµ„æºç®¡ç†å™¨
â”‚       â”‚
â”‚       â”œâ”€â”€ registry/                      # ä¸šåŠ¡å±‚æœåŠ¡æ³¨å†Œ (ç°æœ‰)
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ service_registry.py        # ä¸šåŠ¡æœåŠ¡æ³¨å†Œä¸­å¿ƒ
â”‚       â”‚   â”œâ”€â”€ discovery.py              # ä¸šåŠ¡æœåŠ¡å‘ç°
â”‚       â”‚   â”œâ”€â”€ health_checker.py         # ä¸šåŠ¡å¥åº·æ£€æŸ¥
â”‚       â”‚   â””â”€â”€ infrastructure_bridge.py  # åŸºç¡€è®¾æ–½é›†æˆæ¡¥æ¥ (æ–°å¢)
â”‚       â”‚
â”‚       â”œâ”€â”€ scheduler/                     # ä»»åŠ¡è°ƒåº¦ (ç°æœ‰)
â”‚       â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”œâ”€â”€ task_scheduler.py         # ä»»åŠ¡è°ƒåº¦å™¨
â”‚       â”‚   â”œâ”€â”€ resource_allocator.py     # èµ„æºåˆ†é…å™¨
â”‚       â”‚   â””â”€â”€ scheduling_policy.py      # è°ƒåº¦ç­–ç•¥
â”‚       â”‚
â”‚       â””â”€â”€ governance/                    # æ²»ç†å±‚ (ç°æœ‰)
â”‚           â”œâ”€â”€ __init__.py
â”‚           â””â”€â”€ agent_governance.py       # æ™ºèƒ½ä½“æ²»ç†
â”‚
â””â”€â”€ [å…¶ä»–ç°æœ‰æ¨¡å—ä¿æŒä¸å˜]
```

## æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. ç»Ÿä¸€ç½‘å…³å±‚ (Unified Gateway)

#### æ ¸å¿ƒèŒè´£
- **åè®®è¯†åˆ«** - è‡ªåŠ¨è¯†åˆ«è¯·æ±‚åè®®ç±»å‹
- **è·¯ç”±åˆ†å‘** - å°†è¯·æ±‚è·¯ç”±åˆ°å¯¹åº”çš„åè®®é€‚é…å™¨
- **æµé‡æ§åˆ¶** - ç»Ÿä¸€çš„é€Ÿç‡é™åˆ¶å’Œæµé‡ç®¡ç†
- **ä¸­é—´ä»¶å¤„ç†** - è®¤è¯ã€æ—¥å¿—ã€ç›‘æ§ç­‰æ¨ªåˆ‡å…³æ³¨ç‚¹

#### æ ¸å¿ƒæ¥å£
```python
class UnifiedGateway:
    """ç»Ÿä¸€ç½‘å…³ - å››å¤§åè®®ç»Ÿä¸€å…¥å£"""
    
    async def route_request(
        self,
        request: UnifiedRequest
    ) -> UnifiedResponse:
        """è·¯ç”±è¯·æ±‚åˆ°å¯¹åº”åè®®å¤„ç†å™¨"""
        
    async def register_protocol_handler(
        self,
        protocol_type: str,
        handler: BaseProtocolAdapter
    ) -> bool:
        """æ³¨å†Œåè®®å¤„ç†å™¨"""
        
    async def apply_middleware(
        self,
        request: UnifiedRequest,
        middleware_chain: List[Middleware]
    ) -> UnifiedRequest:
        """åº”ç”¨ä¸­é—´ä»¶é“¾"""
```

#### åè®®è¯†åˆ«ç­–ç•¥
```python
class ProtocolDetector:
    """åè®®æ£€æµ‹å™¨"""
    
    DETECTION_RULES = {
        "acp": {
            "headers": {"Content-Type": "application/acp+json"},
            "path_patterns": ["/acp/*"],
            "payload_signature": ["meta", "context", "command"]
        },
        "a2a": {
            "headers": {"Content-Type": "application/a2a+json"},
            "path_patterns": ["/a2a/*", "/.well-known/agent.json"],
            "payload_signature": ["task", "agent_card"]
        },
        "mcp": {
            "headers": {"Content-Type": "application/json-rpc"},
            "path_patterns": ["/mcp/*"],
            "payload_signature": ["jsonrpc", "method", "params"]
        },
        "bir": {
            "headers": {"Content-Type": "application/json"},
            "path_patterns": ["/bir/*", "/api/*"],
            "payload_signature": ["instruction", "user_id"]
        }
    }
```

### 2. ç»Ÿä¸€æ³¨å†Œä¸­å¿ƒ (Unified Registry)

#### æ ¸å¿ƒèŒè´£
- **æœåŠ¡æ³¨å†Œ** - ç»Ÿä¸€æ³¨å†ŒACPæœåŠ¡å™¨ã€A2Aæ™ºèƒ½ä½“ã€MCPå·¥å…·ã€BIRå¤„ç†å™¨
- **æœåŠ¡å‘ç°** - æä¾›ç»Ÿä¸€çš„æœåŠ¡å‘ç°æ¥å£
- **å¥åº·æ£€æŸ¥** - ç›‘æ§æ‰€æœ‰æ³¨å†ŒæœåŠ¡çš„å¥åº·çŠ¶æ€
- **å…ƒæ•°æ®ç®¡ç†** - ç®¡ç†æœåŠ¡çš„å…ƒæ•°æ®å’Œé…ç½®ä¿¡æ¯

#### ç»Ÿä¸€æœåŠ¡æ¨¡å‹
```python
@dataclass
class UnifiedService:
    """ç»Ÿä¸€æœåŠ¡æ¨¡å‹"""
    service_id: str                    # æœåŠ¡å”¯ä¸€æ ‡è¯†
    service_type: str                  # æœåŠ¡ç±»å‹(acp/a2a/mcp/bir)
    name: str                          # æœåŠ¡åç§°
    version: str                       # æœåŠ¡ç‰ˆæœ¬
    endpoint: str                      # æœåŠ¡ç«¯ç‚¹
    capabilities: List[str]            # æœåŠ¡èƒ½åŠ›
    metadata: Dict[str, Any]           # æ‰©å±•å…ƒæ•°æ®
    health_check_url: str             # å¥åº·æ£€æŸ¥URL
    registration_time: datetime        # æ³¨å†Œæ—¶é—´
    last_heartbeat: datetime          # æœ€åå¿ƒè·³æ—¶é—´
    status: ServiceStatus             # æœåŠ¡çŠ¶æ€
```

#### æœåŠ¡å‘ç°æ¥å£
```python
class UnifiedRegistry:
    """ç»Ÿä¸€æ³¨å†Œä¸­å¿ƒ"""
    
    async def register_service(
        self,
        service: UnifiedService
    ) -> bool:
        """æ³¨å†ŒæœåŠ¡"""
        
    async def discover_services(
        self,
        service_type: str = None,
        capabilities: List[str] = None,
        tags: Dict[str, str] = None
    ) -> List[UnifiedService]:
        """å‘ç°æœåŠ¡"""
        
    async def get_service(
        self,
        service_id: str
    ) -> Optional[UnifiedService]:
        """è·å–ç‰¹å®šæœåŠ¡"""
        
    async def health_check_all(self) -> Dict[str, bool]:
        """æ£€æŸ¥æ‰€æœ‰æœåŠ¡å¥åº·çŠ¶æ€"""
```

### 3. ç»Ÿä¸€è®¤è¯æˆæƒ (Unified Auth)

#### æ ¸å¿ƒèŒè´£
- **èº«ä»½è®¤è¯** - æ”¯æŒå¤šç§è®¤è¯æ–¹å¼(API Keyã€OAuth2ã€JWT)
- **æƒé™æ§åˆ¶** - ç»Ÿä¸€çš„æƒé™æ¨¡å‹å’Œè®¿é—®æ§åˆ¶
- **å®‰å…¨ç­–ç•¥** - è·¨åè®®çš„å®‰å…¨ç­–ç•¥ç®¡ç†
- **å®¡è®¡æ—¥å¿—** - ç»Ÿä¸€çš„å®‰å…¨å®¡è®¡å’Œè®¿é—®æ—¥å¿—

#### ç»Ÿä¸€æƒé™æ¨¡å‹
```python
class UnifiedPermission:
    """ç»Ÿä¸€æƒé™æ¨¡å‹"""
    
    # æƒé™ç±»å‹
    class PermissionType(Enum):
        READ = "read"               # è¯»å–æƒé™
        WRITE = "write"             # å†™å…¥æƒé™
        EXECUTE = "execute"         # æ‰§è¡Œæƒé™
        ADMIN = "admin"             # ç®¡ç†æƒé™
        DELEGATE = "delegate"       # å§”æ‰˜æƒé™
    
    # èµ„æºç±»å‹
    class ResourceType(Enum):
        PROTOCOL = "protocol"       # åè®®èµ„æº
        SERVICE = "service"         # æœåŠ¡èµ„æº
        TOOL = "tool"              # å·¥å…·èµ„æº
        AGENT = "agent"            # æ™ºèƒ½ä½“èµ„æº
        DATA = "data"              # æ•°æ®èµ„æº
```

#### è®¤è¯æˆæƒæ¥å£
```python
class UnifiedAuth:
    """ç»Ÿä¸€è®¤è¯æˆæƒ"""
    
    async def authenticate(
        self,
        credentials: Dict[str, Any],
        protocol_type: str
    ) -> AuthResult:
        """ç»Ÿä¸€èº«ä»½è®¤è¯"""
        
    async def authorize(
        self,
        user_id: str,
        resource: str,
        permission: PermissionType,
        context: Dict[str, Any] = None
    ) -> bool:
        """ç»Ÿä¸€æƒé™æˆæƒ"""
        
    async def create_token(
        self,
        user_id: str,
        scope: List[str],
        expires_in: int = 3600
    ) -> str:
        """åˆ›å»ºè®¿é—®ä»¤ç‰Œ"""
        
    async def validate_token(
        self,
        token: str
    ) -> TokenInfo:
        """éªŒè¯è®¿é—®ä»¤ç‰Œ"""
```

### 4. ç»Ÿä¸€ç›‘æ§è¿½è¸ª (Unified Monitoring)

#### æ ¸å¿ƒèŒè´£
- **ç»Ÿä¸€è¿½è¸ª** - è·¨åè®®çš„åˆ†å¸ƒå¼è¿½è¸ª
- **æŒ‡æ ‡èšåˆ** - ç»Ÿä¸€æ”¶é›†å’Œèšåˆå„åè®®æŒ‡æ ‡
- **å‘Šè­¦ç®¡ç†** - ç»Ÿä¸€çš„å‘Šè­¦è§„åˆ™å’Œé€šçŸ¥æœºåˆ¶
- **æ€§èƒ½åˆ†æ** - è·¨åè®®çš„æ€§èƒ½åˆ†æå’Œä¼˜åŒ–å»ºè®®

#### ç»Ÿä¸€è¿½è¸ªæ¨¡å‹
```python
@dataclass
class UnifiedTrace:
    """ç»Ÿä¸€è¿½è¸ªæ¨¡å‹"""
    trace_id: str                      # è¿½è¸ªID
    span_id: str                       # è·¨åº¦ID
    parent_span_id: Optional[str]      # çˆ¶è·¨åº¦ID
    protocol_type: str                 # åè®®ç±»å‹
    operation_name: str                # æ“ä½œåç§°
    start_time: datetime               # å¼€å§‹æ—¶é—´
    end_time: Optional[datetime]       # ç»“æŸæ—¶é—´
    duration: Optional[float]          # æŒç»­æ—¶é—´
    status: TraceStatus               # è¿½è¸ªçŠ¶æ€
    tags: Dict[str, str]              # æ ‡ç­¾
    logs: List[Dict[str, Any]]        # æ—¥å¿—
    context: Dict[str, Any]           # ä¸Šä¸‹æ–‡ä¿¡æ¯
```

#### ç›‘æ§æ¥å£
```python
class UnifiedTracer:
    """ç»Ÿä¸€è¿½è¸ªå™¨"""
    
    def start_span(
        self,
        operation_name: str,
        protocol_type: str,
        parent_span: Optional[str] = None,
        tags: Dict[str, str] = None
    ) -> UnifiedSpan:
        """å¼€å§‹è¿½è¸ªè·¨åº¦"""
        
    def finish_span(
        self,
        span: UnifiedSpan,
        status: TraceStatus = TraceStatus.SUCCESS
    ):
        """ç»“æŸè¿½è¸ªè·¨åº¦"""
        
    async def get_trace(
        self,
        trace_id: str
    ) -> UnifiedTrace:
        """è·å–å®Œæ•´è¿½è¸ªé“¾"""
        
    async def query_traces(
        self,
        query: TraceQuery
    ) -> List[UnifiedTrace]:
        """æŸ¥è¯¢è¿½è¸ªæ•°æ®"""
```

### 5. ç»Ÿä¸€è¿æ¥ç®¡ç† (Unified Connection)

#### æ ¸å¿ƒèŒè´£
- **è¿æ¥æ± ç®¡ç†** - ç»Ÿä¸€ç®¡ç†å„åè®®çš„è¿æ¥æ± 
- **ä¼šè¯ç®¡ç†** - è·¨åè®®çš„ä¼šè¯çŠ¶æ€ç®¡ç†
- **ä¼ è¾“ä¼˜åŒ–** - è¿æ¥å¤ç”¨å’Œä¼ è¾“åè®®ä¼˜åŒ–
- **æ•…éšœæ¢å¤** - è¿æ¥æ•…éšœæ£€æµ‹å’Œè‡ªåŠ¨æ¢å¤

#### è¿æ¥ç®¡ç†æ¥å£
```python
class UnifiedConnectionPool:
    """ç»Ÿä¸€è¿æ¥æ± """
    
    async def get_connection(
        self,
        protocol_type: str,
        target: str,
        connection_config: Dict[str, Any] = None
    ) -> UnifiedConnection:
        """è·å–è¿æ¥"""
        
    async def return_connection(
        self,
        connection: UnifiedConnection
    ):
        """å½’è¿˜è¿æ¥"""
        
    async def health_check_connections(
        self,
        protocol_type: str = None
    ) -> Dict[str, bool]:
        """æ£€æŸ¥è¿æ¥å¥åº·çŠ¶æ€"""
        
    async def get_pool_stats(self) -> Dict[str, Any]:
        """è·å–è¿æ¥æ± ç»Ÿè®¡ä¿¡æ¯"""
```

### 6. ç»Ÿä¸€é…ç½®ç®¡ç† (Unified Config)

#### æ ¸å¿ƒèŒè´£
- **é…ç½®ç»Ÿä¸€** - ç»Ÿä¸€ç®¡ç†å››å¤§åè®®çš„é…ç½®
- **åŠ¨æ€æ›´æ–°** - æ”¯æŒé…ç½®çš„çƒ­æ›´æ–°å’Œç‰ˆæœ¬ç®¡ç†
- **ç¯å¢ƒéš”ç¦»** - æ”¯æŒå¤šç¯å¢ƒé…ç½®ç®¡ç†
- **é…ç½®éªŒè¯** - é…ç½®çš„è¯­æ³•å’Œè¯­ä¹‰éªŒè¯

#### é…ç½®ç»“æ„
```yaml
# config/unified_infrastructure.yaml
infrastructure:
  # ç»Ÿä¸€ç½‘å…³é…ç½®
  gateway:
    enabled: true
    host: "0.0.0.0"
    port: 8080
    max_connections: 10000
    request_timeout: 30
    middleware:
      - auth
      - rate_limit
      - logging
      - tracing
    
    # åè®®è·¯ç”±é…ç½®
    protocol_routing:
      acp:
        path_prefix: "/acp"
        default_timeout: 30
      a2a:
        path_prefix: "/a2a"
        default_timeout: 45
      mcp:
        path_prefix: "/mcp"
        default_timeout: 60
      bir:
        path_prefix: "/api"
        default_timeout: 15
  
  # ç»Ÿä¸€æ³¨å†Œä¸­å¿ƒé…ç½®
  registry:
    enabled: true
    backend: "etcd"  # etcd/consul/zookeeper
    endpoints: ["http://localhost:2379"]
    health_check_interval: 30
    service_ttl: 60
    
  # ç»Ÿä¸€è®¤è¯é…ç½®
  auth:
    enabled: true
    default_provider: "jwt"
    providers:
      jwt:
        secret_key: "${JWT_SECRET_KEY}"
        algorithm: "HS256"
        expires_in: 3600
      oauth2:
        client_id: "${OAUTH2_CLIENT_ID}"
        client_secret: "${OAUTH2_CLIENT_SECRET}"
        issuer: "https://auth.example.com"
    
    # æƒé™æ˜ å°„
    permission_mapping:
      acp:
        agent_call: ["execute"]
        agent_manage: ["admin"]
      a2a:
        task_create: ["write"]
        task_execute: ["execute"]
      mcp:
        tool_call: ["execute"]
        resource_read: ["read"]
      bir:
        instruction_process: ["execute"]
  
  # ç»Ÿä¸€ç›‘æ§é…ç½®
  monitoring:
    enabled: true
    tracing:
      backend: "jaeger"
      endpoint: "http://localhost:14268/api/traces"
      sampling_rate: 1.0
    metrics:
      backend: "prometheus"
      endpoint: "http://localhost:9090"
      push_interval: 10
    logging:
      level: "INFO"
      format: "json"
      output: ["console", "file"]
  
  # ç»Ÿä¸€è¿æ¥é…ç½®
  connection:
    enabled: true
    pools:
      acp:
        max_connections: 100
        connection_timeout: 10
        idle_timeout: 300
      a2a:
        max_connections: 50
        connection_timeout: 15
        idle_timeout: 600
      mcp:
        max_connections: 200
        connection_timeout: 5
        idle_timeout: 120
    
  # ç»Ÿä¸€é”™è¯¯å¤„ç†é…ç½®
  error:
    enabled: true
    retry:
      max_attempts: 3
      backoff_strategy: "exponential"
      base_delay: 1
    circuit_breaker:
      failure_threshold: 5
      timeout: 60
      half_open_max_calls: 3

# åè®®ç‰¹å®šé…ç½®ä¿æŒç‹¬ç«‹
protocols:
  acp:
    # ACPç‰¹å®šé…ç½®
  a2a:
    # A2Aç‰¹å®šé…ç½®
  mcp:
    # MCPç‰¹å®šé…ç½®
  bir:
    # BIRç‰¹å®šé…ç½®
```

## åè®®é€‚é…å±‚è®¾è®¡

### åè®®é€‚é…å™¨åŸºç±»

```python
class BaseProtocolAdapter:
    """åè®®é€‚é…å™¨åŸºç±»"""
    
    def __init__(
        self,
        protocol_type: str,
        unified_gateway: UnifiedGateway,
        unified_registry: UnifiedRegistry,
        unified_auth: UnifiedAuth,
        unified_tracer: UnifiedTracer
    ):
        self.protocol_type = protocol_type
        self.gateway = unified_gateway
        self.registry = unified_registry
        self.auth = unified_auth
        self.tracer = unified_tracer
    
    async def handle_request(
        self,
        request: UnifiedRequest
    ) -> UnifiedResponse:
        """å¤„ç†åè®®è¯·æ±‚ - å­ç±»å¿…é¡»å®ç°"""
        raise NotImplementedError
    
    async def validate_request(
        self,
        request: UnifiedRequest
    ) -> bool:
        """éªŒè¯è¯·æ±‚æ ¼å¼ - å­ç±»å¯é‡å†™"""
        return True
    
    async def transform_request(
        self,
        unified_request: UnifiedRequest
    ) -> Any:
        """å°†ç»Ÿä¸€è¯·æ±‚è½¬æ¢ä¸ºåè®®ç‰¹å®šæ ¼å¼"""
        raise NotImplementedError
    
    async def transform_response(
        self,
        protocol_response: Any
    ) -> UnifiedResponse:
        """å°†åè®®å“åº”è½¬æ¢ä¸ºç»Ÿä¸€æ ¼å¼"""
        raise NotImplementedError
```

### ACPåè®®é€‚é…å™¨

```python
class ACPProtocolAdapter(BaseProtocolAdapter):
    """ACPåè®®é€‚é…å™¨"""
    
    def __init__(self, **kwargs):
        super().__init__("acp", **kwargs)
        self.acp_server = None  # ç°æœ‰ACPæœåŠ¡å™¨å®ä¾‹
    
    async def handle_request(
        self,
        request: UnifiedRequest
    ) -> UnifiedResponse:
        """å¤„ç†ACPè¯·æ±‚"""
        
        # 1. éªŒè¯è¯·æ±‚
        if not await self.validate_request(request):
            return UnifiedResponse.error("Invalid ACP request format")
        
        # 2. è®¤è¯æˆæƒ
        auth_result = await self.auth.authenticate(
            request.credentials, "acp"
        )
        if not auth_result.success:
            return UnifiedResponse.error("Authentication failed")
        
        # 3. å¼€å§‹è¿½è¸ª
        span = self.tracer.start_span(
            "acp_request", "acp",
            tags={"user_id": auth_result.user_id}
        )
        
        try:
            # 4. è½¬æ¢è¯·æ±‚æ ¼å¼
            acp_payload = await self.transform_request(request)
            
            # 5. è°ƒç”¨ç°æœ‰ACPå¤„ç†é€»è¾‘
            result = await self.acp_server.handle_message(acp_payload)
            
            # 6. è½¬æ¢å“åº”æ ¼å¼
            response = await self.transform_response(result)
            
            self.tracer.finish_span(span, TraceStatus.SUCCESS)
            return response
            
        except Exception as e:
            self.tracer.finish_span(span, TraceStatus.ERROR)
            return UnifiedResponse.error(str(e))
    
    async def transform_request(
        self,
        unified_request: UnifiedRequest
    ) -> ACPPayload:
        """è½¬æ¢ä¸ºACPè½½è·æ ¼å¼"""
        return ACPPayload(
            meta=unified_request.headers,
            context=unified_request.context,
            command=unified_request.payload,
            trace_id=unified_request.trace_id,
            context_id=unified_request.context_id,
            timestamp=int(time.time()),
            source_id=unified_request.source_id
        )
```

## é›†æˆç°æœ‰æ¡†æ¶

### 1. ä¸ç°æœ‰é€šä¿¡åŸŸé›†æˆ

```python
# ä¿®æ”¹ src/communication/__init__.py
from ..infrastructure import UnifiedGateway, UnifiedRegistry
from .protocol_adapters import ACPAdapter, A2AAdapter, MCPAdapter, BIRAdapter

class CommunicationDomain:
    """é€šä¿¡åŸŸ - é›†æˆç»Ÿä¸€åŸºç¡€è®¾æ–½"""
    
    def __init__(self, config: Dict[str, Any]):
        # ç»Ÿä¸€åŸºç¡€è®¾æ–½
        self.unified_gateway = UnifiedGateway(config)
        self.unified_registry = UnifiedRegistry(config)
        
        # åè®®é€‚é…å™¨
        self.adapters = {
            "acp": ACPAdapter(self.unified_gateway, self.unified_registry),
            "a2a": A2AAdapter(self.unified_gateway, self.unified_registry),
            "mcp": MCPAdapter(self.unified_gateway, self.unified_registry),
            "bir": BIRAdapter(self.unified_gateway, self.unified_registry)
        }
        
        # æ³¨å†Œåè®®å¤„ç†å™¨
        for protocol_type, adapter in self.adapters.items():
            self.unified_gateway.register_protocol_handler(
                protocol_type, adapter
            )
    
    async def start(self):
        """å¯åŠ¨é€šä¿¡åŸŸ"""
        await self.unified_gateway.start()
        await self.unified_registry.start()
        
        # å¯åŠ¨å„åè®®é€‚é…å™¨
        for adapter in self.adapters.values():
            await adapter.start()
```

### 2. ä¸ç°æœ‰åè°ƒåŸŸé›†æˆ

```python
# æ‰©å±• src/coordination/registry/service_registry.py
class ServiceRegistry:
    """æœåŠ¡æ³¨å†Œè¡¨ - é›†æˆç»Ÿä¸€æ³¨å†Œä¸­å¿ƒ"""
    
    def __init__(self, config: Dict[str, Any]):
        # ç°æœ‰é€»è¾‘ä¿æŒä¸å˜
        self.agents = {}
        self.services = {}
        
        # é›†æˆç»Ÿä¸€æ³¨å†Œä¸­å¿ƒ
        self.unified_registry = UnifiedRegistry(config)
    
    async def register_agent(self, agent_info: AgentInfo) -> bool:
        """æ³¨å†Œæ™ºèƒ½ä½“ - åŒæ—¶æ³¨å†Œåˆ°ç»Ÿä¸€æ³¨å†Œä¸­å¿ƒ"""
        # ç°æœ‰æ³¨å†Œé€»è¾‘
        success = await self._register_agent_local(agent_info)
        
        if success:
            # æ³¨å†Œåˆ°ç»Ÿä¸€æ³¨å†Œä¸­å¿ƒ
            unified_service = UnifiedService(
                service_id=agent_info.agent_id,
                service_type="agent",
                name=agent_info.name,
                endpoint=agent_info.endpoint,
                capabilities=agent_info.capabilities,
                metadata={"agent_type": agent_info.agent_type}
            )
            await self.unified_registry.register_service(unified_service)
        
        return success
```

### 3. ä¸ç°æœ‰ç›‘æ§åŸŸé›†æˆ

```python
# æ‰©å±• src/monitoring/tracing/trace_writer.py
class TraceWriter:
    """è¿½è¸ªå†™å…¥å™¨ - é›†æˆç»Ÿä¸€è¿½è¸ª"""
    
    def __init__(self, config: Dict[str, Any]):
        # ç°æœ‰é€»è¾‘
        self.traces = {}
        
        # é›†æˆç»Ÿä¸€è¿½è¸ª
        self.unified_tracer = UnifiedTracer(config)
    
    def record_trace(
        self,
        trace_id: str,
        trace_type: TraceType,
        message: str,
        data: Dict[str, Any] = None
    ):
        """è®°å½•è¿½è¸ª - åŒæ—¶å†™å…¥ç»Ÿä¸€è¿½è¸ªç³»ç»Ÿ"""
        # ç°æœ‰é€»è¾‘
        self._record_trace_local(trace_id, trace_type, message, data)
        
        # å†™å…¥ç»Ÿä¸€è¿½è¸ªç³»ç»Ÿ
        self.unified_tracer.record_event(
            trace_id=trace_id,
            event_name=trace_type.value,
            data={
                "message": message,
                "data": data,
                "timestamp": datetime.utcnow()
            }
        )
```

## éƒ¨ç½²é…ç½®

### Docker Composeéƒ¨ç½²

```yaml
# docker-compose.infrastructure.yml
version: '3.8'

services:
  # ç»Ÿä¸€ç½‘å…³
  unified-gateway:
    build:
      context: .
      dockerfile: docker/infrastructure/gateway.Dockerfile
    ports:
      - "8080:8080"
    environment:
      - INFRASTRUCTURE_CONFIG=/app/config/unified_infrastructure.yaml
      - GATEWAY_HOST=0.0.0.0
      - GATEWAY_PORT=8080
    volumes:
      - ./config:/app/config
    depends_on:
      - etcd
      - jaeger
      - prometheus
    restart: unless-stopped
  
  # ç»Ÿä¸€æ³¨å†Œä¸­å¿ƒå­˜å‚¨
  etcd:
    image: quay.io/coreos/etcd:v3.5.0
    ports:
      - "2379:2379"
      - "2380:2380"
    environment:
      - ETCD_ADVERTISE_CLIENT_URLS=http://localhost:2379
      - ETCD_LISTEN_CLIENT_URLS=http://0.0.0.0:2379
    volumes:
      - etcd_data:/etcd-data
  
  # åˆ†å¸ƒå¼è¿½è¸ª
  jaeger:
    image: jaegertracing/all-in-one:latest
    ports:
      - "16686:16686"
      - "14268:14268"
    environment:
      - COLLECTOR_ZIPKIN_HTTP_PORT=9411
  
  # ç›‘æ§æŒ‡æ ‡
  prometheus:
    image: prom/prometheus:latest
    ports:
      - "9090:9090"
    volumes:
      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheus_data:/prometheus

volumes:
  etcd_data:
  prometheus_data:
```

### Kuberneteséƒ¨ç½²

```yaml
# k8s/infrastructure-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: unified-infrastructure
spec:
  replicas: 3
  selector:
    matchLabels:
      app: unified-infrastructure
  template:
    metadata:
      labels:
        app: unified-infrastructure
    spec:
      containers:
      - name: unified-gateway
        image: nagent/unified-infrastructure:latest
        ports:
        - containerPort: 8080
        env:
        - name: INFRASTRUCTURE_CONFIG
          value: "/app/config/unified_infrastructure.yaml"
        - name: ETCD_ENDPOINTS
          value: "http://etcd:2379"
        - name: JAEGER_ENDPOINT
          value: "http://jaeger:14268/api/traces"
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
        volumeMounts:
        - name: config
          mountPath: /app/config
        livenessProbe:
          httpGet:
            path: /health
            port: 8080
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /ready
            port: 8080
          initialDelaySeconds: 5
          periodSeconds: 5
      volumes:
      - name: config
        configMap:
          name: infrastructure-config
---
apiVersion: v1
kind: Service
metadata:
  name: unified-infrastructure
spec:
  selector:
    app: unified-infrastructure
  ports:
  - port: 8080
    targetPort: 8080
  type: LoadBalancer
```

## ç›‘æ§ä¸è¿ç»´

### å…³é”®æŒ‡æ ‡

```python
# ç»Ÿä¸€åŸºç¡€è®¾æ–½å…³é”®æŒ‡æ ‡
INFRASTRUCTURE_METRICS = {
    # ç½‘å…³æŒ‡æ ‡
    "gateway_requests_total": "ç½‘å…³æ€»è¯·æ±‚æ•°",
    "gateway_request_duration": "ç½‘å…³è¯·æ±‚å¤„ç†æ—¶é—´",
    "gateway_protocol_distribution": "åè®®è¯·æ±‚åˆ†å¸ƒ",
    "gateway_error_rate": "ç½‘å…³é”™è¯¯ç‡",
    
    # æ³¨å†Œä¸­å¿ƒæŒ‡æ ‡
    "registry_services_total": "æ³¨å†ŒæœåŠ¡æ€»æ•°",
    "registry_health_check_duration": "å¥åº·æ£€æŸ¥è€—æ—¶",
    "registry_service_discovery_rate": "æœåŠ¡å‘ç°è¯·æ±‚ç‡",
    
    # è®¤è¯æŒ‡æ ‡
    "auth_requests_total": "è®¤è¯è¯·æ±‚æ€»æ•°",
    "auth_success_rate": "è®¤è¯æˆåŠŸç‡",
    "auth_token_created_total": "åˆ›å»ºä»¤ç‰Œæ€»æ•°",
    "auth_permission_check_duration": "æƒé™æ£€æŸ¥è€—æ—¶",
    
    # è¿æ¥æ± æŒ‡æ ‡
    "connection_pool_size": "è¿æ¥æ± å¤§å°",
    "connection_pool_utilization": "è¿æ¥æ± åˆ©ç”¨ç‡",
    "connection_creation_duration": "è¿æ¥åˆ›å»ºè€—æ—¶",
    "connection_failures_total": "è¿æ¥å¤±è´¥æ€»æ•°"
}
```

### å‘Šè­¦è§„åˆ™

```yaml
# monitoring/infrastructure-alerts.yml
groups:
- name: unified-infrastructure
  rules:
  - alert: GatewayHighErrorRate
    expr: rate(gateway_errors_total[5m]) / rate(gateway_requests_total[5m]) > 0.05
    for: 2m
    labels:
      severity: warning
    annotations:
      summary: "ç»Ÿä¸€ç½‘å…³é”™è¯¯ç‡è¿‡é«˜"
      
  - alert: RegistryServiceDown
    expr: registry_services_healthy / registry_services_total < 0.9
    for: 1m
    labels:
      severity: critical
    annotations:
      summary: "æ³¨å†Œä¸­å¿ƒæœåŠ¡å¥åº·ç‡ä½äº90%"
      
  - alert: AuthServiceUnavailable
    expr: up{job="unified-auth"} == 0
    for: 30s
    labels:
      severity: critical
    annotations:
      summary: "ç»Ÿä¸€è®¤è¯æœåŠ¡ä¸å¯ç”¨"
      
  - alert: ConnectionPoolExhausted
    expr: connection_pool_utilization > 0.9
    for: 5m
    labels:
      severity: warning
    annotations:
      summary: "è¿æ¥æ± åˆ©ç”¨ç‡è¿‡é«˜"
```

## å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€è®¾æ–½æ ¸å¿ƒï¼ˆ2-3å‘¨ï¼‰
1. **ç»Ÿä¸€ç½‘å…³å®ç°**
   - åè®®è¯†åˆ«å’Œè·¯ç”±
   - åŸºç¡€ä¸­é—´ä»¶æ”¯æŒ
   - åè®®é€‚é…å™¨æ¡†æ¶

2. **ç»Ÿä¸€æ³¨å†Œä¸­å¿ƒå®ç°**
   - æœåŠ¡æ³¨å†Œå’Œå‘ç°
   - å¥åº·æ£€æŸ¥æœºåˆ¶
   - å…ƒæ•°æ®ç®¡ç†

3. **ç»Ÿä¸€è®¤è¯æˆæƒå®ç°**
   - å¤šç§è®¤è¯æ–¹å¼æ”¯æŒ
   - ç»Ÿä¸€æƒé™æ¨¡å‹
   - å®‰å…¨ç­–ç•¥ç®¡ç†

### ç¬¬äºŒé˜¶æ®µï¼šç›‘æ§ä¸è¿æ¥ï¼ˆ2å‘¨ï¼‰
1. **ç»Ÿä¸€ç›‘æ§é›†æˆ**
   - è·¨åè®®è¿½è¸ª
   - æŒ‡æ ‡èšåˆ
   - å‘Šè­¦ç®¡ç†

2. **ç»Ÿä¸€è¿æ¥ç®¡ç†**
   - è¿æ¥æ± å®ç°
   - ä¼ è¾“ä¼˜åŒ–
   - æ•…éšœæ¢å¤

### ç¬¬ä¸‰é˜¶æ®µï¼šåè®®é€‚é…ï¼ˆ3-4å‘¨ï¼‰
1. **å››å¤§åè®®é€‚é…å™¨å®ç°**
   - ACPåè®®é€‚é…å™¨
   - A2Aåè®®é€‚é…å™¨
   - MCPåè®®é€‚é…å™¨
   - BIRåè®®é€‚é…å™¨

2. **ç°æœ‰æ¡†æ¶é›†æˆ**
   - é€šä¿¡åŸŸé›†æˆ
   - åè°ƒåŸŸé›†æˆ
   - ç›‘æ§åŸŸé›†æˆ

### ç¬¬å››é˜¶æ®µï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ2å‘¨ï¼‰
1. **é›†æˆæµ‹è¯•**
   - è·¨åè®®è°ƒç”¨æµ‹è¯•
   - æ€§èƒ½å‹åŠ›æµ‹è¯•
   - æ•…éšœæ¢å¤æµ‹è¯•

2. **æ€§èƒ½ä¼˜åŒ–**
   - è¿æ¥æ± ä¼˜åŒ–
   - ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
   - ç›‘æ§æ€§èƒ½è°ƒä¼˜

## æ–¹æ¡ˆè°ƒæ•´ä¸å®Œå–„

### ğŸ” ç°çŠ¶åˆ†æä¸é—®é¢˜è¯†åˆ«

åŸºäºæ™ºèƒ½ä½“APIç½‘å…³è®¾è®¡å’Œä¼ä¸šçº§æ¶æ„å®è·µçš„æ·±å…¥åˆ†æï¼Œå½“å‰ç»Ÿä¸€åŸºç¡€è®¾æ–½è®¾è®¡æ–¹æ¡ˆå­˜åœ¨ä»¥ä¸‹å…³é”®ç¼ºå¤±ï¼š

#### å…³é”®é—®é¢˜æ¸…å•
```yaml
æ¶æ„å®Œæ•´æ€§é—®é¢˜:
  - src/infrastructure/ ç›®å½•å®Œå…¨ä¸ºç©ºï¼Œç¼ºå°‘æ ¸å¿ƒå®ç°
  - ç¼ºå°‘ç§Ÿæˆ·æ²»ç†å±‚å’Œå¤šç§Ÿæˆ·éš”ç¦»æœºåˆ¶
  - æ²¡æœ‰ä¼ä¸šçº§å®‰å…¨é˜²æŠ¤å±‚è®¾è®¡
  - ç­–ç•¥å¼•æ“åŠŸèƒ½è¿‡äºç®€åŒ–

å®‰å…¨æœºåˆ¶ç¼ºå¤±:
  - ç¼ºå°‘é˜²é‡æ”¾æ”»å‡»æœºåˆ¶ï¼ˆæ—¶é—´æˆ³+ç­¾å+Nonceï¼‰
  - æ²¡æœ‰é˜²åˆ·æµæ£€æµ‹å’Œè¡Œä¸ºæ¨¡å¼è¯†åˆ«
  - Tokenæƒé™æ§åˆ¶ç²’åº¦ä¸å¤Ÿç»†åŒ–
  - ç¼ºå°‘ç§Ÿæˆ·çº§å®‰å…¨ç­–ç•¥ç®¡ç†

ç›‘æ§ä½“ç³»ä¸è¶³:
  - è¿½è¸ªæ•°æ®ç»“æ„ç¼ºå°‘ä¸šåŠ¡çº§æŒ‡æ ‡
  - æ²¡æœ‰APIç½‘å…³ä¸“ç”¨ç›‘æ§æŒ‡æ ‡
  - ç¼ºå°‘å®‰å…¨äº‹ä»¶å’Œå¼‚å¸¸è¡Œä¸ºæ£€æµ‹
  - ç›‘æ§æ•°æ®ä¸ä¸šåŠ¡å†³ç­–è„±èŠ‚

é…ç½®ç®¡ç†ç®€åŒ–:
  - é…ç½®ç»“æ„è¿‡äºç®€å•ï¼Œä¸æ”¯æŒç§Ÿæˆ·åˆ†å±‚
  - ç¼ºå°‘åŠ¨æ€ç­–ç•¥DSLæ”¯æŒ
  - æ²¡æœ‰A/Bæµ‹è¯•å’Œç°åº¦å‘å¸ƒæœºåˆ¶
  - é…ç½®çƒ­æ›´æ–°å’Œç‰ˆæœ¬ç®¡ç†ä¸å®Œå–„
```

### ğŸ¯ æ¶æ„å±‚æ¬¡è°ƒæ•´

#### æ–°å¢æ¶æ„å±‚æ¬¡
```mermaid
graph TB
    subgraph "å¤–éƒ¨è¯·æ±‚å±‚"
        EXT1[ACPå®¢æˆ·ç«¯]
        EXT2[A2Aæ™ºèƒ½ä½“]
        EXT3[MCPå·¥å…·]
        EXT4[BIRç”¨æˆ·è¯·æ±‚]
        EXT5[å…¶ä»–å¤–éƒ¨ç³»ç»Ÿ]
    end
    
    subgraph "ç§Ÿæˆ·æ²»ç†å±‚ (Tenant Governance Layer) - æ–°å¢"
        TM[ç§Ÿæˆ·ç®¡ç†å™¨<br/>TenantManager<br/>å¤šç§Ÿæˆ·éš”ç¦»ç®¡ç†]
        TQ[é…é¢æ§åˆ¶å™¨<br/>QuotaController<br/>ç§Ÿæˆ·çº§é…é¢æ§åˆ¶]
        TP[ç­–ç•¥åˆ†å±‚å™¨<br/>PolicyLayering<br/>ç§Ÿæˆ·ç­–ç•¥åˆ†å±‚]
    end
    
    subgraph "å®‰å…¨é˜²æŠ¤å±‚ (Security Protection Layer) - æ–°å¢"
        AR[é˜²é‡æ”¾æ¨¡å—<br/>AntiReplay<br/>æ—¶é—´æˆ³+ç­¾å+Nonce]
        AA[é˜²æ»¥ç”¨æ¨¡å—<br/>AntiAbuse<br/>åˆ·æµæ£€æµ‹+è¡Œä¸ºè¯†åˆ«]
        SC[æƒé™ç»†åŒ–æ§åˆ¶<br/>ScopeControl<br/>Tokenç²¾ç»†åŒ–æƒé™]
    end
    
    subgraph "ç­–ç•¥å¼•æ“å±‚ (Policy Engine Layer) - å¢å¼º"
        PE[ç­–ç•¥å¼•æ“<br/>PolicyEngine<br/>DSLç­–ç•¥ç¼–æ’]
        RD[è§„åˆ™ä¸‹å‘å™¨<br/>RuleDispatcher<br/>åŠ¨æ€è§„åˆ™ä¸‹å‘]
        AB[A/Bæµ‹è¯•å¼•æ“<br/>ABTestEngine<br/>å®éªŒç­–ç•¥æ”¯æŒ]
    end
    
    subgraph "ç»Ÿä¸€åŸºç¡€è®¾æ–½å±‚ (Infrastructure) - åŸæœ‰"
        UG[ç»Ÿä¸€ç½‘å…³]
        UA[ç»Ÿä¸€è®¤è¯æˆæƒ]
        UM[ç»Ÿä¸€ç›‘æ§è¿½è¸ª]
        UC[ç»Ÿä¸€é…ç½®ç®¡ç†]
        UE[ç»Ÿä¸€é”™è¯¯å¤„ç†]
        UN[ç»Ÿä¸€è¿æ¥æ± ]
    end
    
    %% æ–°å¢å±‚æ¬¡é—´çš„å…³ç³»
    EXT1 --> TM
    EXT2 --> TM
    EXT3 --> TM
    EXT4 --> TM
    EXT5 --> TM
    
    TM --> AR
    TQ --> AA
    TP --> SC
    
    AR --> PE
    AA --> RD
    SC --> AB
    
    PE --> UG
    RD --> UA
    AB --> UM
```

#### å±‚æ¬¡èŒè´£é‡æ–°å®šä¹‰

##### 1. ç§Ÿæˆ·æ²»ç†å±‚ (æ–°å¢)
```yaml
èŒè´£èŒƒå›´: å¤šç§Ÿæˆ·ç®¡ç†å’Œèµ„æºæ§åˆ¶
æ ¸å¿ƒç»„ä»¶:
  - TenantManager: ç§Ÿæˆ·æ³¨å†Œã€è®¤è¯ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†
  - QuotaController: QPSé™åˆ¶ã€Tokené…é¢ã€æˆæœ¬æ§åˆ¶
  - PolicyLayering: å…¨å±€/ç§Ÿæˆ·/ç”¨æˆ·ä¸‰å±‚ç­–ç•¥ç®¡ç†
  
å…³é”®èƒ½åŠ›:
  - ç§Ÿæˆ·éš”ç¦»: æ•°æ®éš”ç¦»ã€èµ„æºéš”ç¦»ã€ç½‘ç»œéš”ç¦»
  - é…é¢ç®¡ç†: å®æ—¶é…é¢ç›‘æ§ã€è¶…é™å‘Šè­¦ã€è‡ªåŠ¨é™æµ
  - ç­–ç•¥ç»§æ‰¿: ç­–ç•¥åˆ†å±‚ã€æƒé™ç»§æ‰¿ã€ç­–ç•¥è¦†ç›–
```

##### 2. å®‰å…¨é˜²æŠ¤å±‚ (æ–°å¢)
```yaml
èŒè´£èŒƒå›´: ä¼ä¸šçº§å®‰å…¨é˜²æŠ¤å’Œå¨èƒæ£€æµ‹
æ ¸å¿ƒç»„ä»¶:
  - AntiReplay: é˜²é‡æ”¾æ”»å‡»ã€ç­¾åéªŒè¯ã€æ—¶é—´çª—å£æ§åˆ¶
  - AntiAbuse: é˜²åˆ·æµæ£€æµ‹ã€è¡Œä¸ºæ¨¡å¼è¯†åˆ«ã€IPä¿¡èª‰æ£€æŸ¥
  - ScopeControl: Tokenæƒé™ç»†åŒ–ã€æ¨¡å‹ç™½åå•ã€åŒºåŸŸæ§åˆ¶
  
å…³é”®èƒ½åŠ›:
  - æ”»å‡»é˜²æŠ¤: é‡æ”¾æ”»å‡»ã€æš´åŠ›ç ´è§£ã€DDoSé˜²æŠ¤
  - è¡Œä¸ºåˆ†æ: å¼‚å¸¸æ£€æµ‹ã€é£é™©è¯„åˆ†ã€è‡ªåŠ¨å“åº”
  - ç²¾ç»†æˆæƒ: èµ„æºçº§æƒé™ã€æ—¶é—´çª—å£ã€åœ°åŸŸé™åˆ¶
```

##### 3. ç­–ç•¥å¼•æ“å±‚ (å¢å¼º)
```yaml
èŒè´£èŒƒå›´: åŠ¨æ€ç­–ç•¥ç®¡ç†å’Œæ™ºèƒ½å†³ç­–
æ ¸å¿ƒç»„ä»¶:
  - PolicyEngine: DSLç­–ç•¥è§£æã€è§„åˆ™æ‰§è¡Œã€ç­–ç•¥ç»„åˆ
  - RuleDispatcher: ç­–ç•¥çƒ­æ›´æ–°ã€ç‰ˆæœ¬ç®¡ç†ã€ç°åº¦å‘å¸ƒ
  - ABTestEngine: A/Bæµ‹è¯•ã€æµé‡åˆ†å‰²ã€æ•ˆæœè¯„ä¼°
  
å…³é”®èƒ½åŠ›:
  - ç­–ç•¥ç¼–æ’: å¤æ‚è§„åˆ™ç»„åˆã€æ¡ä»¶åˆ¤æ–­ã€åŠ¨ä½œæ‰§è¡Œ
  - çƒ­æ›´æ–°: æ— ä¸­æ–­æ›´æ–°ã€ç‰ˆæœ¬å›æ»šã€é…ç½®åŒæ­¥
  - å®éªŒæ”¯æŒ: å¤šæ¨¡å‹å¯¹æ¯”ã€æ•ˆæœè¿½è¸ªã€æ™ºèƒ½åˆ‡æ¢
```

### ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶å¢å¼ºè®¾è®¡

#### é˜²é‡æ”¾æ”»å‡»æœºåˆ¶
```python
# å¢å¼ºçš„é˜²é‡æ”¾æœºåˆ¶è®¾è®¡
class AntiReplayProtection:
    """é˜²é‡æ”¾æ”»å‡»ä¿æŠ¤"""
    
    def __init__(self):
        self.nonce_cache = RedisCache(ttl=300)  # 5åˆ†é’ŸTTL
        self.max_timestamp_drift = 60  # 1åˆ†é’Ÿæ—¶é—´æ¼‚ç§»
        self.signature_algorithms = ["HMAC-SHA256", "RSA-SHA256"]
    
    async def validate_request(self, request: UnifiedRequest) -> bool:
        # 1. æ—¶é—´æˆ³éªŒè¯
        timestamp = request.headers.get("X-Timestamp")
        if abs(time.time() - int(timestamp)) > self.max_timestamp_drift:
            raise TimestampExpiredError("Request timestamp expired")
        
        # 2. Nonceå”¯ä¸€æ€§æ£€æŸ¥
        nonce = request.headers.get("X-Nonce")
        if await self.nonce_cache.exists(nonce):
            raise ReplayAttackError("Nonce already used")
        
        # 3. ç­¾åéªŒè¯
        signature = request.headers.get("X-Signature")
        if not self.verify_signature(request.payload, signature):
            raise InvalidSignatureError("Signature verification failed")
        
        # 4. è®°å½•Nonce
        await self.nonce_cache.set(nonce, True)
        return True

# è¯·æ±‚æ ¼å¼è¦æ±‚
request_format:
  headers:
    X-Tenant-ID: "ent-301"
    X-Timestamp: "1714801001"
    X-Nonce: "2da1c0e9af134"
    X-Signature: "0c9f08d..."
    Authorization: "Bearer eyJhbGciOiJIUzI1NiIs..."
```

#### é˜²åˆ·æµæ£€æµ‹æœºåˆ¶
```python
class AntiAbuseDetection:
    """é˜²æ»¥ç”¨æ£€æµ‹"""
    
    def __init__(self):
        self.behavior_analyzer = BehaviorAnalyzer()
        self.ip_reputation = IPReputationService()
        self.rate_tracker = RateTracker()
    
    async def detect_abuse(self, request: UnifiedRequest) -> RiskAssessment:
        risk_score = 0.0
        risk_factors = []
        
        # 1. çªå‘æµé‡æ£€æµ‹
        burst_ratio = await self.rate_tracker.get_burst_ratio(
            request.tenant_id, window=60
        )
        if burst_ratio > 5.0:  # çªå‘æµé‡è¶…è¿‡å¹³å‡5å€
            risk_score += 0.3
            risk_factors.append("high_burst_traffic")
        
        # 2. IPä¿¡èª‰æ£€æŸ¥
        ip_reputation = await self.ip_reputation.check(request.client_ip)
        if ip_reputation < 0.5:  # ä¿¡èª‰åˆ†æ•°ä½äº0.5
            risk_score += 0.4
            risk_factors.append("low_ip_reputation")
        
        # 3. è¡Œä¸ºæ¨¡å¼åˆ†æ
        behavior_score = await self.behavior_analyzer.analyze(
            request.tenant_id, request.user_agent, request.request_pattern
        )
        if behavior_score > 0.8:  # å¼‚å¸¸è¡Œä¸ºåˆ†æ•°é«˜äº0.8
            risk_score += 0.5
            risk_factors.append("abnormal_behavior_pattern")
        
        return RiskAssessment(
            risk_score=min(risk_score, 1.0),
            risk_factors=risk_factors,
            recommended_action=self._get_recommended_action(risk_score)
        )

# æ£€æµ‹æŒ‡æ ‡é…ç½®
abuse_detection_config:
  burst_detection:
    window_seconds: 60
    threshold_multiplier: 5.0
    
  ip_reputation:
    min_reputation_score: 0.5
    reputation_cache_ttl: 3600
    
  behavior_analysis:
    pattern_window: 300
    anomaly_threshold: 0.8
    features: ["request_frequency", "user_agent_variation", "endpoint_diversity"]
```

#### Tokenæƒé™ç»†åŒ–æ§åˆ¶
```python
class ScopeControl:
    """Tokenæƒé™ç»†åŒ–æ§åˆ¶"""
    
    def __init__(self):
        self.permission_matrix = PermissionMatrix()
        self.resource_mapper = ResourceMapper()
    
    async def validate_scope(self, token: TokenInfo, request: UnifiedRequest) -> bool:
        # 1. æ¨¡å‹è®¿é—®æƒé™æ£€æŸ¥
        if request.model not in token.allowed_models:
            raise ModelAccessDeniedError(
                f"Model '{request.model}' not allowed for token scope"
            )
        
        # 2. åŒºåŸŸè®¿é—®æƒé™æ£€æŸ¥
        if request.region not in token.allowed_regions:
            raise RegionAccessDeniedError(
                f"Region '{request.region}' not allowed for token scope"
            )
        
        # 3. æ—¶é—´çª—å£æƒé™æ£€æŸ¥
        current_hour = datetime.now().hour
        if not token.access_window.is_allowed(current_hour):
            raise TimeWindowViolationError(
                f"Access not allowed at hour {current_hour}"
            )
        
        # 4. èµ„æºçº§æƒé™æ£€æŸ¥
        required_permissions = self.resource_mapper.get_required_permissions(
            request.action, request.resource_type
        )
        if not token.permissions.contains_all(required_permissions):
            raise InsufficientPermissionsError(
                f"Missing permissions: {required_permissions - token.permissions}"
            )
        
        return True

# Tokenæƒé™ç»“æ„å¢å¼º
token_scope_structure:
  tenant_id: "ent-301"
  user_id: "user-123"
  permissions:
    models: ["gpt-4", "claude-3"]
    regions: ["cn-bj", "cn-sh", "us-west"]
    actions: ["read", "write", "execute"]
    resources: ["agent:*", "tool:basic", "data:public"]
    quotas:
      qps_limit: 300
      token_limit_daily: 50000
      cost_limit_daily_usd: 10.0
    restrictions:
      access_window: ["09:00", "18:00"]
      ip_whitelist: ["192.168.1.0/24"]
      user_agent_pattern: "^MyApp/.*"
```

### ğŸ“Š ç›‘æ§ä½“ç³»å¢å¼ºè®¾è®¡

#### ç»Ÿä¸€è¿½è¸ªæ¨¡å‹å¢å¼º
```python
@dataclass
class EnhancedUnifiedTrace:
    """å¢å¼ºçš„ç»Ÿä¸€è¿½è¸ªæ¨¡å‹"""
    
    # åŸºç¡€è¿½è¸ªä¿¡æ¯
    trace_id: str
    span_id: str
    parent_span_id: Optional[str]
    protocol_type: str
    start_time: datetime
    end_time: Optional[datetime]
    duration_ms: Optional[float]
    status: TraceStatus
    
    # ç§Ÿæˆ·å’Œç”¨æˆ·ä¿¡æ¯
    tenant_id: str
    user_id: Optional[str]
    session_id: Optional[str]
    
    # ä¸šåŠ¡æŒ‡æ ‡
    business_metrics: BusinessMetrics
    
    # å®‰å…¨æŒ‡æ ‡  
    security_metrics: SecurityMetrics
    
    # æ€§èƒ½æŒ‡æ ‡
    performance_metrics: PerformanceMetrics
    
    # æˆæœ¬æŒ‡æ ‡
    cost_metrics: CostMetrics

@dataclass
class BusinessMetrics:
    """ä¸šåŠ¡æŒ‡æ ‡"""
    model_called: str
    token_usage: TokenUsage
    cache_hit: bool
    result_quality_score: Optional[float]
    user_satisfaction_score: Optional[float]

@dataclass  
class SecurityMetrics:
    """å®‰å…¨æŒ‡æ ‡"""
    auth_method: str
    permissions_checked: List[str]
    rate_limit_applied: bool
    security_events: List[SecurityEvent]
    risk_score: float
    threat_indicators: List[str]

@dataclass
class PerformanceMetrics:
    """æ€§èƒ½æŒ‡æ ‡"""
    gateway_latency_ms: float
    auth_latency_ms: float
    routing_latency_ms: float
    backend_latency_ms: float
    total_latency_ms: float
    queue_wait_time_ms: float

@dataclass
class CostMetrics:
    """æˆæœ¬æŒ‡æ ‡"""
    api_cost_usd: float
    compute_cost_usd: float
    storage_cost_usd: float
    total_cost_usd: float
    cost_efficiency_score: float
```

#### APIç½‘å…³ä¸“ç”¨ç›‘æ§æŒ‡æ ‡
```yaml
gateway_specific_metrics:
  # è¯·æ±‚æŒ‡æ ‡
  request_metrics:
    gateway_requests_total:
      labels: [protocol, tenant_id, status_code, region]
      description: "ç½‘å…³å¤„ç†çš„è¯·æ±‚æ€»æ•°"
    
    gateway_request_duration_seconds:
      labels: [protocol, tenant_id, endpoint]
      description: "ç½‘å…³è¯·æ±‚å¤„ç†æ—¶é—´åˆ†å¸ƒ"
    
    gateway_protocol_distribution:
      labels: [protocol]
      description: "åè®®è¯·æ±‚åˆ†å¸ƒ"
    
    gateway_tenant_distribution:
      labels: [tenant_id, tier]
      description: "ç§Ÿæˆ·è¯·æ±‚åˆ†å¸ƒ"

  # å®‰å…¨æŒ‡æ ‡
  security_metrics:
    gateway_auth_failures_total:
      labels: [tenant_id, auth_method, failure_reason]
      description: "è®¤è¯å¤±è´¥æ€»æ•°"
    
    gateway_rate_limit_hits_total:
      labels: [tenant_id, limit_type, protocol]
      description: "é™æµè§¦å‘æ€»æ•°"
    
    gateway_security_events_total:
      labels: [event_type, severity, tenant_id]
      description: "å®‰å…¨äº‹ä»¶æ€»æ•°"
    
    gateway_replay_attempts_total:
      labels: [tenant_id, client_ip]
      description: "é‡æ”¾æ”»å‡»å°è¯•æ€»æ•°"

  # ä¸šåŠ¡æŒ‡æ ‡
  business_metrics:
    gateway_token_usage_total:
      labels: [tenant_id, model, token_type]
      description: "Tokenä½¿ç”¨æ€»é‡"
    
    gateway_cost_tracking_usd:
      labels: [tenant_id, model, cost_type]
      description: "æˆæœ¬è¿½è¸ªï¼ˆç¾å…ƒï¼‰"
    
    gateway_model_usage_distribution:
      labels: [model, tenant_tier]
      description: "æ¨¡å‹ä½¿ç”¨åˆ†å¸ƒ"
    
    gateway_tenant_quota_utilization:
      labels: [tenant_id, quota_type]
      description: "ç§Ÿæˆ·é…é¢åˆ©ç”¨ç‡"

  # æ€§èƒ½æŒ‡æ ‡
  performance_metrics:
    gateway_latency_breakdown:
      labels: [component, protocol]
      description: "ç½‘å…³å»¶è¿Ÿåˆ†è§£"
    
    gateway_throughput_qps:
      labels: [protocol, tenant_tier]
      description: "ç½‘å…³ååé‡"
    
    gateway_error_rate:
      labels: [error_type, protocol]
      description: "ç½‘å…³é”™è¯¯ç‡"
```

### ğŸ”§ é…ç½®ç®¡ç†å¢å¼ºè®¾è®¡

#### ç§Ÿæˆ·åˆ†å±‚é…ç½®ç»“æ„
```yaml
# å¢å¼ºçš„ç»Ÿä¸€é…ç½®ç»“æ„
unified_infrastructure_enhanced:
  # ç§Ÿæˆ·ç®¡ç†é…ç½®
  tenant_management:
    default_quotas:
      qps_limit: 100
      token_limit_monthly: 100000
      cost_limit_monthly_usd: 50.0
      concurrent_requests: 10
      
    tenant_tiers:
      free:
        qps: 10
        tokens: 10000
        cost: 5.0
        models: ["gpt-3.5-turbo"]
        regions: ["cn-bj"]
        features: ["basic_auth"]
        
      basic:
        qps: 100
        tokens: 100000
        cost: 50.0
        models: ["gpt-3.5-turbo", "claude-3-haiku"]
        regions: ["cn-bj", "cn-sh"]
        features: ["basic_auth", "rate_limit"]
        
      premium:
        qps: 1000
        tokens: 1000000
        cost: 500.0
        models: ["gpt-4", "claude-3-opus"]
        regions: ["global"]
        features: ["advanced_auth", "custom_policies", "priority_support"]
        
      enterprise:
        qps: 10000
        tokens: 10000000
        cost: 5000.0
        models: ["all"]
        regions: ["global"]
        features: ["sso", "custom_deployment", "dedicated_support"]

  # å®‰å…¨ç­–ç•¥é…ç½®
  security_policies:
    global_policies:
      - name: "anti_replay"
        enabled: true
        config:
          nonce_ttl: 300
          max_timestamp_drift: 60
          signature_algorithms: ["HMAC-SHA256", "RSA-SHA256"]
          
      - name: "anti_abuse"
        enabled: true
        config:
          burst_threshold: 5.0
          ip_reputation_threshold: 0.5
          behavior_anomaly_threshold: 0.8
          
      - name: "rate_limiting"
        enabled: true
        config:
          algorithm: "token_bucket"
          window_seconds: 60
          burst_factor: 1.5

    tenant_specific_policies:
      "ent-enterprise":
        custom_policies:
          - name: "advanced_threat_detection"
            enabled: true
            config:
              ml_model: "enterprise_threat_model_v2"
              sensitivity: "high"
              
          - name: "custom_rate_limiting"
            enabled: true
            config:
              algorithm: "adaptive_sliding_window"
              base_limit: 1000
              adaptive_factor: 2.0

  # ç­–ç•¥DSLé…ç½®
  policy_dsl:
    enabled: true
    engine: "rego"  # æˆ– "cel", "javascript"
    
    global_rules:
      - name: "business_hours_restriction"
        rule: |
          package nagent.policies
          
          default allow = false
          
          allow {
            input.tenant_tier == "enterprise"
          }
          
          allow {
            input.tenant_tier != "enterprise"
            time.now_ns() >= time.parse_rfc3339_ns("09:00:00Z")
            time.now_ns() <= time.parse_rfc3339_ns("18:00:00Z")
          }
          
      - name: "model_access_control"
        rule: |
          package nagent.policies
          
          allowed_models[model] {
            tier_config := data.tenant_tiers[input.tenant_tier]
            model := tier_config.models[_]
          }
          
          deny[msg] {
            not allowed_models[input.model]
            msg := sprintf("Model '%s' not allowed for tier '%s'", [input.model, input.tenant_tier])
          }

  # A/Bæµ‹è¯•é…ç½®
  ab_testing:
    enabled: true
    experiments:
      - name: "model_routing_experiment"
        description: "æ¯”è¾ƒä¸åŒæ¨¡å‹çš„æ•ˆæœ"
        status: "active"
        traffic_split:
          control: 50  # ä½¿ç”¨é»˜è®¤æ¨¡å‹
          treatment: 50  # ä½¿ç”¨æ–°æ¨¡å‹
        target_metrics:
          - "response_quality"
          - "latency"
          - "cost_efficiency"
        duration_days: 14
        
      - name: "rate_limiting_algorithm"
        description: "æµ‹è¯•ä¸åŒé™æµç®—æ³•"
        status: "active"
        variants:
          token_bucket: 33
          sliding_window: 33
          adaptive: 34
        target_metrics:
          - "fairness"
          - "throughput"
          - "user_experience"

  # ç›‘æ§å‘Šè­¦é…ç½®
  monitoring_alerts:
    enabled: true
    
    alert_rules:
      - name: "HighErrorRate"
        condition: "rate(gateway_errors_total[5m]) / rate(gateway_requests_total[5m]) > 0.05"
        duration: "2m"
        severity: "warning"
        annotations:
          summary: "ç½‘å…³é”™è¯¯ç‡è¿‡é«˜"
          
      - name: "SecurityThreatDetected"
        condition: "increase(gateway_security_events_total[1m]) > 10"
        duration: "30s"
        severity: "critical"
        annotations:
          summary: "æ£€æµ‹åˆ°å®‰å…¨å¨èƒ"
          
      - name: "TenantQuotaExceeded"
        condition: "gateway_tenant_quota_utilization > 0.9"
        duration: "1m"
        severity: "warning"
        annotations:
          summary: "ç§Ÿæˆ·é…é¢å³å°†è€—å°½"

    notification_channels:
      - name: "slack"
        type: "slack"
        config:
          webhook_url: "${SLACK_WEBHOOK_URL}"
          channel: "#alerts"
          
      - name: "email"
        type: "email"
        config:
          smtp_server: "smtp.example.com"
          recipients: ["ops@example.com"]
```

### ğŸš€ å®æ–½è®¡åˆ’è°ƒæ•´

#### é‡æ–°è§„åˆ’çš„å®æ–½é˜¶æ®µ
```yaml
ç¬¬ä¸€é˜¶æ®µ (2å‘¨) - å®‰å…¨ä¼˜å…ˆåŸºç¡€è®¾æ–½:
  priority: P0
  ç›®æ ‡: å»ºç«‹å®‰å…¨å¯é çš„åŸºç¡€æ¡†æ¶
  components:
    - ç»Ÿä¸€ç½‘å…³åŸºç¡€æ¡†æ¶ï¼ˆåè®®è¯†åˆ«ã€è·¯ç”±ï¼‰
    - é˜²é‡æ”¾æ”»å‡»æœºåˆ¶ï¼ˆæ—¶é—´æˆ³+ç­¾å+Nonceï¼‰
    - åŸºç¡€è®¤è¯æˆæƒï¼ˆJWT + API Keyï¼‰
    - ç§Ÿæˆ·ç®¡ç†åŸºç¡€ï¼ˆæ³¨å†Œã€é…é¢ã€éš”ç¦»ï¼‰
  
  deliverables:
    - src/infrastructure/gateway/unified_gateway.py
    - src/infrastructure/auth/unified_auth.py
    - src/infrastructure/security/anti_replay.py
    - src/infrastructure/tenant/tenant_manager.py

ç¬¬äºŒé˜¶æ®µ (2å‘¨) - å®‰å…¨é˜²æŠ¤å®Œå–„:
  priority: P0  
  ç›®æ ‡: å®Œå–„ä¼ä¸šçº§å®‰å…¨é˜²æŠ¤èƒ½åŠ›
  components:
    - é˜²åˆ·æµæ£€æµ‹ï¼ˆè¡Œä¸ºåˆ†æã€IPä¿¡èª‰ï¼‰
    - Tokenæƒé™ç»†åŒ–æ§åˆ¶ï¼ˆæ¨¡å‹ã€åŒºåŸŸã€æ—¶é—´ï¼‰
    - å®‰å…¨å®¡è®¡æ—¥å¿—ï¼ˆäº‹ä»¶è®°å½•ã€å¨èƒè¿½è¸ªï¼‰
    - é™æµæœºåˆ¶å¢å¼ºï¼ˆå¤šç»´åº¦ã€è‡ªé€‚åº”ï¼‰
  
  deliverables:
    - src/infrastructure/security/anti_abuse.py
    - src/infrastructure/security/scope_control.py
    - src/infrastructure/monitoring/security_audit.py
    - src/infrastructure/gateway/rate_limiter.py

ç¬¬ä¸‰é˜¶æ®µ (3å‘¨) - é«˜çº§æ²»ç†èƒ½åŠ›:
  priority: P1
  ç›®æ ‡: å®ç°æ™ºèƒ½åŒ–ç­–ç•¥ç®¡ç†
  components:
    - DSLç­–ç•¥å¼•æ“ï¼ˆRego/CELç­–ç•¥è§£æï¼‰
    - åŠ¨æ€é…ç½®ç®¡ç†ï¼ˆçƒ­æ›´æ–°ã€ç‰ˆæœ¬æ§åˆ¶ï¼‰
    - A/Bæµ‹è¯•æ”¯æŒï¼ˆæµé‡åˆ†å‰²ã€æ•ˆæœè¯„ä¼°ï¼‰
    - ç§Ÿæˆ·è‡ªå®šä¹‰ç­–ç•¥ï¼ˆç­–ç•¥ç¼–æ’ã€æƒé™å§”æ‰˜ï¼‰
  
  deliverables:
    - src/infrastructure/policy/policy_engine.py
    - src/infrastructure/config/dynamic_config.py
    - src/infrastructure/experiment/ab_test_engine.py
    - src/infrastructure/tenant/custom_policies.py

ç¬¬å››é˜¶æ®µ (2å‘¨) - ç›‘æ§ä¼˜åŒ–ä¸è¿ç»´:
  priority: P1
  ç›®æ ‡: å®Œå–„ç›‘æ§ä½“ç³»å’Œè¿ç»´å·¥å…·
  components:
    - ç»Ÿä¸€ç›‘æ§ä»ªè¡¨æ¿ï¼ˆå¤šç»´åº¦æŒ‡æ ‡ã€å®æ—¶ç›‘æ§ï¼‰
    - æ€§èƒ½ä¼˜åŒ–ï¼ˆç¼“å­˜ã€è¿æ¥æ± ã€è´Ÿè½½å‡è¡¡ï¼‰
    - æ™ºèƒ½å‘Šè­¦ï¼ˆå¼‚å¸¸æ£€æµ‹ã€è‡ªåŠ¨å“åº”ï¼‰
    - è¿ç»´å·¥å…·ï¼ˆé…ç½®ç®¡ç†ã€æ•…éšœè¯Šæ–­ï¼‰
  
  deliverables:
    - src/infrastructure/monitoring/dashboard_api.py
    - src/infrastructure/optimization/performance_optimizer.py
    - src/infrastructure/monitoring/intelligent_alerts.py
    - tools/infrastructure_cli.py

ç¬¬äº”é˜¶æ®µ (1å‘¨) - é›†æˆæµ‹è¯•ä¸æ–‡æ¡£:
  priority: P1
  ç›®æ ‡: ç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§
  components:
    - é›†æˆæµ‹è¯•ï¼ˆè·¨åè®®è°ƒç”¨ã€æ•…éšœæ¢å¤ï¼‰
    - æ€§èƒ½å‹åŠ›æµ‹è¯•ï¼ˆé«˜å¹¶å‘ã€å¤§æµé‡ï¼‰
    - å®‰å…¨æ¸—é€æµ‹è¯•ï¼ˆæ”»å‡»æ¨¡æ‹Ÿã€é˜²æŠ¤éªŒè¯ï¼‰
    - æ–‡æ¡£å®Œå–„ï¼ˆéƒ¨ç½²æŒ‡å—ã€è¿ç»´æ‰‹å†Œï¼‰
  
  deliverables:
    - tests/integration/infrastructure_tests.py
    - tests/performance/load_tests.py
    - tests/security/penetration_tests.py
    - docs/infrastructure_deployment_guide.md
```

### ğŸ“‹ é›†æˆç­–ç•¥è°ƒæ•´

#### ä¸ç°æœ‰æ¶æ„çš„æ·±åº¦é›†æˆ
```python
# åè°ƒåŸŸé›†æˆå¢å¼º
coordination_infrastructure_integration:
  # åŒé‡æ³¨å†Œæœºåˆ¶
  service_registry_bridge:
    business_layer: "src/coordination/registry/service_registry.py"
    infrastructure_layer: "src/infrastructure/registry/unified_registry.py"
    bridge_component: "src/coordination/registry/infrastructure_bridge.py"
    
    integration_strategy:
      - ä¸šåŠ¡æœåŠ¡æ³¨å†Œåˆ°åè°ƒåŸŸæ³¨å†Œä¸­å¿ƒ
      - åŒæ—¶æ³¨å†Œåˆ°åŸºç¡€è®¾æ–½ç»Ÿä¸€æ³¨å†Œä¸­å¿ƒ
      - é€šè¿‡æ¡¥æ¥ç»„ä»¶ä¿æŒæ•°æ®åŒæ­¥
      - æ”¯æŒæœåŠ¡å‘ç°çš„åŒé‡æŸ¥è¯¢
  
  # æ²»ç†ç­–ç•¥ç»Ÿä¸€
  governance_integration:
    coordination_governance: "src/coordination/governance/agent_governance.py"
    api_gateway_governance: "src/infrastructure/governance/api_governance.py"
    unified_policy_engine: "src/infrastructure/policy/unified_policy_engine.py"
    
    integration_strategy:
      - Agentçº§åˆ«æ²»ç†ç­–ç•¥ï¼ˆåè°ƒåŸŸï¼‰
      - ç§Ÿæˆ·çº§åˆ«æ²»ç†ç­–ç•¥ï¼ˆåŸºç¡€è®¾æ–½å±‚ï¼‰
      - ç»Ÿä¸€ç­–ç•¥å¼•æ“åè°ƒä¸¤å±‚ç­–ç•¥
      - ç­–ç•¥å†²çªæ£€æµ‹å’Œè§£å†³æœºåˆ¶

# é€šä¿¡åŸŸåè®®é€‚é…å¢å¼º
communication_protocol_enhancement:
  existing_protocols:
    acp: "src/communication/acp/"
    mcp: "src/communication/protocols/mcp/"
    adapters: "src/communication/adapters/"
  
  enhancement_components:
    unified_adapter_framework: "src/infrastructure/adapters/base_protocol_adapter.py"
    protocol_version_manager: "src/infrastructure/protocols/version_manager.py"
    message_transformer: "src/infrastructure/protocols/message_transformer.py"
    middleware_support: "src/infrastructure/gateway/protocol_middleware.py"
  
  integration_strategy:
    - ç°æœ‰åè®®é€‚é…å™¨ç»§æ‰¿ç»Ÿä¸€åŸºç¡€æ¡†æ¶
    - åè®®ç‰ˆæœ¬ç®¡ç†ç»Ÿä¸€åŒ–
    - è·¨åè®®æ¶ˆæ¯è½¬æ¢æ”¯æŒ
    - åè®®ç‰¹å®šä¸­é—´ä»¶æ’ä»¶åŒ–

# ç›‘æ§åŸŸè¿½è¸ªå¢å¼º
monitoring_tracing_enhancement:
  existing_monitoring: "src/monitoring/"
  infrastructure_monitoring: "src/infrastructure/monitoring/"
  
  integration_components:
    trace_bridge: "src/monitoring/tracing/infrastructure_bridge.py"
    metrics_aggregator: "src/infrastructure/monitoring/metrics_aggregator.py"
    unified_dashboard: "src/infrastructure/monitoring/unified_dashboard.py"
  
  integration_strategy:
    - ç°æœ‰TraceWriteré›†æˆç»Ÿä¸€è¿½è¸ª
    - ä¸šåŠ¡æŒ‡æ ‡å’ŒåŸºç¡€è®¾æ–½æŒ‡æ ‡èšåˆ
    - ç»Ÿä¸€ç›‘æ§ä»ªè¡¨æ¿å±•ç¤º
    - å‘Šè­¦è§„åˆ™ç»Ÿä¸€ç®¡ç†
```

## æ€»ç»“

### ğŸ¯ æ ¸å¿ƒä»·å€¼

1. **ç»Ÿä¸€ç®¡ç†** - å››å¤§åè®®å…±äº«åŸºç¡€è®¾æ–½ï¼Œé™ä½50%çš„é‡å¤å»ºè®¾æˆæœ¬
2. **ç®€åŒ–è¿ç»´** - ç»Ÿä¸€çš„ç›‘æ§ã€é…ç½®å’Œéƒ¨ç½²ï¼Œè¿ç»´å¤æ‚åº¦é™ä½60%
3. **æå‡æ€§èƒ½** - ç»Ÿä¸€è¿æ¥æ± å’Œè´Ÿè½½å‡è¡¡ï¼Œæ•´ä½“æ€§èƒ½æå‡30%
4. **å¢å¼ºå®‰å…¨** - ç»Ÿä¸€è®¤è¯æˆæƒï¼Œå®‰å…¨ç®¡æ§ä¸€è‡´æ€§æå‡90%
5. **å¿«é€Ÿæ‰©å±•** - æ ‡å‡†åŒ–åè®®é€‚é…æ¡†æ¶ï¼Œæ–°åè®®æ¥å…¥æ—¶é—´ç¼©çŸ­80%

### ğŸ”§ æŠ€æœ¯ä¼˜åŠ¿

1. **å®Œæ•´çš„å®‰å…¨é˜²æŠ¤ä½“ç³»** - é˜²é‡æ”¾ã€é˜²åˆ·æµã€ç²¾ç»†åŒ–æƒé™æ§åˆ¶
2. **æ™ºèƒ½åŒ–ç­–ç•¥ç®¡ç†** - DSLç­–ç•¥å¼•æ“ã€åŠ¨æ€é…ç½®ã€A/Bæµ‹è¯•æ”¯æŒ
3. **ä¼ä¸šçº§ç›‘æ§ä½“ç³»** - ä¸šåŠ¡æŒ‡æ ‡ã€å®‰å…¨æŒ‡æ ‡ã€æ€§èƒ½æŒ‡æ ‡å…¨è¦†ç›–
4. **å¤šç§Ÿæˆ·æ²»ç†èƒ½åŠ›** - ç§Ÿæˆ·éš”ç¦»ã€é…é¢ç®¡ç†ã€ç­–ç•¥åˆ†å±‚
5. **å¹³æ»‘é›†æˆæ–¹æ¡ˆ** - ä¸ç°æœ‰æ¡†æ¶æ·±åº¦é›†æˆï¼Œæ¸è¿›å¼å‡çº§

### ğŸš€ å®æ–½æ•ˆæœ

é€šè¿‡å¢å¼ºçš„ç»Ÿä¸€åŸºç¡€è®¾æ–½å»ºè®¾ï¼ŒNagentæ¶æ„å°†çœŸæ­£å®ç°ï¼š
- **åè®®äº’æ“ä½œ** - å››å¤§åè®®ç»Ÿä¸€ç®¡ç†å’Œè°ƒåº¦ï¼Œå®‰å…¨å¯æ§
- **è¿ç»´ç®€åŒ–** - ä¸€å¥—åŸºç¡€è®¾æ–½æ”¯æ’‘æ‰€æœ‰åè®®ï¼Œæ™ºèƒ½åŒ–è¿ç»´
- **æ€§èƒ½ä¼˜åŒ–** - å…±äº«èµ„æºå’Œæ™ºèƒ½è°ƒåº¦ï¼Œè‡ªé€‚åº”ä¼˜åŒ–
- **å®‰å…¨å¢å¼º** - ä¼ä¸šçº§å®‰å…¨é˜²æŠ¤ï¼Œå…¨æ–¹ä½å¨èƒæ£€æµ‹
- **æ‰©å±•ä¾¿åˆ©** - æ–°åè®®å¿«é€Ÿæ¥å…¥ï¼Œç­–ç•¥çµæ´»é…ç½®

è¿™å¥—å¢å¼ºçš„ç»Ÿä¸€åŸºç¡€è®¾æ–½å°†æˆä¸ºä¼ä¸šçº§å¤šåè®®æ™ºèƒ½ä½“ç³»ç»Ÿçš„åšå®åŸºçŸ³ï¼Œæ”¯æ’‘å¹³å°åœ¨å¤æ‚ä¸šåŠ¡åœºæ™¯ä¸‹çš„å®‰å…¨ã€ç¨³å®šã€é«˜æ•ˆè¿è¡Œï¼ 